INCLUDE_DIRECTORIES(
	.
	../obdinfo/
)

SET(OBD_SIMGEN_RANDOM "On" CACHE BOOL "Enable Random obdsim generator")
IF(OBD_SIMGEN_RANDOM)
	ADD_LIBRARY(ckobdsim_random STATIC
		./generators/gen_random.c)
	SET(GENERATOR_LIBS ${GENERATOR_LIBS} ckobdsim_random)
	ADD_DEFINITIONS(-DOBDSIMGEN_RANDOM)
ENDIF(OBD_SIMGEN_RANDOM)

SET(OBD_SIMGEN_LOGGER "On" CACHE BOOL "Enable Logger obdsim generator")
IF(OBD_SIMGEN_LOGGER)
	ADD_LIBRARY(ckobdsim_logger STATIC
		./generators/gen_logger.c)
	SET(GENERATOR_LIBS ${GENERATOR_LIBS} ckobdsim_logger cksqlite)
	ADD_DEFINITIONS(-DOBDSIMGEN_LOGGER)
ENDIF(OBD_SIMGEN_LOGGER)

INCLUDE(CheckSymbolExists)
INCLUDE(CheckFunctionExists)
CHECK_FUNCTION_EXISTS(ptsname_r HAVE_PTSNAME_R)
IF(HAVE_PTSNAME_R)
	ADD_DEFINITIONS(-DHAVE_PTSNAME_R)
ENDIF(HAVE_PTSNAME_R)

FILE(GLOB OBDSIM_SRCS
	*.c
)

SET(OBDSIM_LIBS
	ckobdinfo ckobdconfigfile
	${GENERATOR_LIBS}
)

IF("${CMAKE_SYSTEM}" MATCHES "Linux")
	SET(OBDSIM_LIBS ${OBDSIM_LIBS} pthread dl)
ENDIF("${CMAKE_SYSTEM}" MATCHES "Linux")

ADD_EXECUTABLE(obdsim ${OBDSIM_SRCS})

TARGET_LINK_LIBRARIES(obdsim ${OBDSIM_LIBS})

INSTALL(TARGETS obdsim
	RUNTIME DESTINATION bin)

